# Travis RPM Builder

[![Build Status](https://travis-ci.org/UnitedRPMs/travis-rpm-builder.svg?branch=master)](https://travis-ci.org/UnitedRPMs/travis-rpm-builder)

### Source code
* [Original project](https://github.com/nrechn/mock-travis)
* [Fork](https://github.com/paulcarroty/mock-travis) - now used in URPMs

### How to use

**Warning:** `.spec` config must have directly HTTP(S) URL for all `Source:` and `Patch:`. See the [example](https://github.com/UnitedRPMs/mpv/blob/master/mpv.spec#L13).

1. Make you changes in code and select a targed in `.travis.yml`. For example, we need to build new ffmpeg release for Fedora 25 and enable notification for Slack:
``` Yaml
mock_travis:
  mock_config: fedora-25-x86_64 (fedora-24-x86_64 or fedora-rawhide-x86_64)
  packages_buildrequires_git: UnitedRPMs/ffmpeg
sudo: required
services:
- docker
script:
- wget -q https://github.com/paulcarroty/mock-travis/releases/download/stable/mock-travis
  && chmod +x mock-travis && ./mock-travis
before_deploy:
  - docker cp mock-build:/var/tmp/birudo/ /tmp/
deploy:
  provider: releases
  api_key:
    secure: xxxxxcode (generated by `$ travis setup releases`)
  file_glob: true
  file: "/tmp/birudo/RPM/*rpm"
  file: "/tmp/birudo/RPM/*log"
  skip_cleanup: true
  overwrite: true
  on:
    repo: paulcarroty/travis-rpm-test
    tags: true
notifications:
slack: unitedrpms:lzDykHTpajKrgmGz9NkrO1Hj
```

2. Create a commit: `$ git add . && git commit -m 'commit message'`
3. Grab latest tags via `$ git pull --tags` or `$ git fetch --tags`
4. Create your own release tag: `$ git tag -a ffmpegF25 -m 'ffmpeg 3.x.x for Fedora 25'`
5. Push your changes: `$ git push --tags origin master`
6. Check your binaries in https://github.com/OWNER/PROJECT/releases

### Documentation:
* https://docs.travis-ci.com/
* https://docs.travis-ci.com/user/deployment/releases/

### TODO
* TravisCI is limited for 50min build time, make configs for CircleCI and GitlabCI (or alternative)


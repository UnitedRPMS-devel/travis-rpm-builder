# Travis RPM Builder

[![Build Status](https://travis-ci.org/UnitedRPMs/travis-rpm-builder.svg?branch=master)](https://travis-ci.org/UnitedRPMs/travis-rpm-builder)

### Source code
* [Original project](https://github.com/nrechn/mock-travis)
* [Fork](https://github.com/paulcarroty/mock-travis) - now used in URPMs

### How to use

**Warning:** `.spec` config must have directly HTTP(S) URL for all `Source:` and `Patch:`. See the [example](https://github.com/UnitedRPMs/mpv/blob/master/mpv.spec#L13).

1. Make you changes in code and select a targed in `.travis.yml`. For example, we need to build new ffmpeg release for Fedora 25 and enable notification for Slack:
``` Yaml
mock_travis:
  mock_config: fedora-25-x86_64 (fedora-24-x86_64 or fedora-rawhide-x86_64)
  packages_buildrequires_git: UnitedRPMs/ffmpeg
sudo: required
services:
- docker
script:
- wget -q https://github.com/paulcarroty/mock-travis/releases/download/stable/mock-travis
  && chmod +x mock-travis && ./mock-travis
  
################ONLY##FOR##DEPLOY###########################################  
before_deploy:
  - docker cp mock-build:/var/tmp/birudo/ /tmp/
deploy:
  provider: releases
  api_key:
    secure: xxxxxcode (generated by `$ travis setup releases`)
  file_glob: true
  file: "/tmp/birudo/RPM/*rpm"
  skip_cleanup: true
  overwrite: true
  on:
    repo: paulcarroty/travis-rpm-test
    tags: true
################ONLY##FOR##DEPLOY###########################################      
notifications:
slack: unitedrpms:lzDykHTpajKrgmGz9NkrO1Hj
```

2. `$ ./run-build.sh`
3. Check your binaries in https://github.com/OWNER/PROJECT/releases, for example - https://github.com/UnitedRPMs/travis-rpm-builder/releases


### Documentation:
* https://docs.travis-ci.com/
* https://docs.travis-ci.com/user/deployment/releases/

### TODO
* TravisCI is limited for 50min build time, make configs for CircleCI and GitlabCI (or alternative)

### How to download the result packages

```
$ curl -s https://api.github.com/repos/UnitedRPMs/travis-rpm-builder/releases | grep browser_download_url | cut -d '"' -f 4 > urls

//or

$ curl -s https://api.github.com/repos/UnitedRPMs/travis-rpm-builder/releases/latest | grep browser_download_url | cut -d '"' -f 4 > urls

$ wget -c -i urls
```
